    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8" />
        <title>Invoice #<?!= invoice.number ?></title>
        <base target="_top">
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
                max-width: 800px;
                margin: auto;
                padding: 25px;
                color: #333;
                font-size: 13px;
                line-height: 1.6;
            }
            .invoice-box {
                border: 1px solid #eee;
                box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
                padding: 25px;
            }
            .header {
                display: flex;
                justify-content: space-between;
                align-items: flex-start; 
                margin-bottom: 25px;
                padding-bottom: 15px;
                border-bottom: 2px solid #f0f0f0;
            }
            .logo {
                max-width: 180px; 
                max-height: 70px;
                margin-right: 20px;
            }
            .invoice-header-details {
                text-align: right;
            }
            .invoice-header-details h1 {
                font-size: 26px;
                color: #222;
                margin: 0 0 5px 0;
                font-weight: 600;
            }
            .invoice-header-details div {
                font-size: 13px;
                margin-bottom: 2px;
            }
            .columns-container {
                display: flex;
                justify-content: space-between;
                margin-bottom: 25px;
            }
            .column {
                width: 48%;
            }
            .column h3 {
                margin-top: 0;
                margin-bottom: 8px;
                font-size: 15px;
                border-bottom: 1px solid #eee;
                padding-bottom: 5px;
                font-weight: 600;
            }
            .address-block { 
                white-space: pre-line; /* Preserves newlines from data passed to it */
            }
            .address-block .contact-name { /* For customerName and deliveryContactName */
                display: block; /* Ensures it takes its own line */
                font-weight: bold;
                margin-bottom: 2px; 
            }
             .address-block .client-name {
                display: block; /* Ensures it takes its own line */
                margin-bottom: 2px;
            }
            .contact-details div { /* For phone and email lines */
                 margin-top: 2px;
            }

            table.items-table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 25px;
            }
            table.items-table th, table.items-table td {
                padding: 9px 11px;
                border: 1px solid #ddd;
                text-align: left;
                vertical-align: top;
            }
            table.items-table th {
                background-color: #f7f7f7;
                font-weight: bold;
            }
            .item-description-notes {
                font-size: 0.85em;
                color: #555;
                margin-top: 3px;
                font-style: italic;
            }
            table.totals-table {
                width: 50%;
                margin-left: 50%; 
                border-collapse: collapse;
            }
            table.totals-table td {
                padding: 8px 10px;
                font-size: 14px;
                border: none; 
            }
            table.totals-table tr td:first-child {
                text-align: right;
                font-weight: bold;
                padding-right: 15px;
            }
            table.totals-table tr.grand-total td {
                font-weight: bold;
                font-size: 17px;
                border-top: 2px solid #333;
                padding-top: 8px;
            }
            .footer {
                text-align: center;
                font-size: 11px;
                color: #888;
                margin-top: 30px;
                padding-top: 15px;
                border-top: 1px solid #eee;
            }
        </style>
    </head>
    <body>
        <div class="invoice-box">
            <div class="header">
                <img src="<?!= LOGO_IMAGE_BASE64_WEBP ?>" class="logo" alt="El Merkury Logo" />
                <div class="invoice-header-details">
                    <h1>INVOICE</h1>
                    <div>Invoice #: <?!= invoice.number ?></div>
                    <? if (invoice.poNumber && invoice.poNumber.trim() !== "") { ?>
                        <div>PO Number: <?!= invoice.poNumber ?></div>
                    <? } else { ?>
                        <div>PO Number: </div> 
                    <? } ?>
                </div>
            </div>

            <div class="columns-container">
                <div class="column">
                    <h3>Billed To:</h3>
                    <div class="address-block">
                        <span class="contact-name"><?!= invoice.customerName ?></span>
                        <? if (invoice.customerClient && invoice.customerClient !== 'Unknown') { ?>
                            <span class="client-name"><?!= invoice.customerClient ?></span>
                        <? } ?>
                        <?!= invoice.customerAddress ?>
                        <div class="contact-details">
                            <? if (invoice.customerPhone) { ?><div>Phone: <?!= invoice.customerPhone ?></div><? } ?>
                            <? if (invoice.customerEmail) { ?><div>Email: <?!= invoice.customerEmail ?></div><? } ?>
                        </div>
                    </div>
                </div>
                <div class="column">
                    <h3>Deliver To:</h3>
                    <div class="address-block">
                        <span class="contact-name"><?!= invoice.deliveryContactName ?></span>
                         <? if (invoice.deliveryContactPhone) { ?><div>Phone: <?!= invoice.deliveryContactPhone ?></div><? } ?>
                        <?!= invoice.deliveryFullAddress ?>
                    </div>
                    <br/>
                    <div><strong>Delivery Instructions:</strong> <?!= invoice.deliveryDateFormatted ?> at <?!= invoice.deliveryTimeFormatted ?></div>
                </div>
            </div>

            <table class="items-table">
                <thead>
                    <tr>
                        <th>Description</th>
                        <th style="text-align:center; width:10%;">Qty</th>
                        <th style="text-align:right; width:20%;">Unit Price</th>
                        <th style="text-align:right; width:20%;">Total</th>
                    </tr>
                </thead>
                <tbody>
                    <? for (var i = 0; i < invoice.items.length; i++) { var item = invoice.items[i]; ?>
                    <tr>
                        <td>
                            <?!= item.description ?>
                            <? if (item.customerNotesOnly && item.customerNotesOnly.trim() !== "") { ?>
                            <div class="item-description-notes">Customer Notes: <?!= item.customerNotesOnly ?></div>
                            <? } ?>
                        </td>
                        <td style="text-align:center;"><?!= item.qty ?></td>
                        <td style="text-align:right;">$<?!= item.unitPrice.toFixed(2) ?></td>
                        <td style="text-align:right;">$<?!= item.total.toFixed(2) ?></td>
                    </tr>
                    <? } ?>
                </tbody>
            </table>

            <table class="totals-table">
                <tbody>
                    <tr>
                        <td>Items Subtotal:</td>
                        <td>$<?!= invoice.itemsSubtotal.toFixed(2) ?></td>
                    </tr>
                    <? if (invoice.tip > 0) { ?>
                    <tr>
                        <td>Tip:</td>
                        <td>$<?!= invoice.tip.toFixed(2) ?></td>
                    </tr>
                    <? } ?>
                    <? if (invoice.otherChargesAmount > 0 && invoice.otherChargesDescription) { ?>
                    <tr>
                        <td><?!= invoice.otherChargesDescription ?>:</td>
                        <td>$<?!= invoice.otherChargesAmount.toFixed(2) ?></td>
                    </tr>
                    <? } ?>
                    <? if (invoice.deliveryFee > 0) { ?>
                    <tr>
                        <td>Delivery Fee:</td>
                        <td>$<?!= invoice.deliveryFee.toFixed(2) ?></td>
                    </tr>
                    <? } ?>
                    <? if (invoice.utensilsCost > 0) { ?>
                    <tr>
                        <td>Utensils (<?!= invoice.utensilsCount ?> sets):</td>
                        <td>$<?!= invoice.utensilsCost.toFixed(2) ?></td>
                    </tr>
                    <? } ?>
                    <tr class="grand-total">
                        <td>Grand Total:</td>
                        <td>$<?!= invoice.grandTotal.toFixed(2) ?></td>
                    </tr>
                </tbody>
            </table>
        </div> 
        <div class="footer">
            El Merkury | 2104 Chestnut St | Philadelphia PA 19103 | (267) 457-5952 | catering@elmerkury.com
        </div>
    </body>
    </html>